<Window
    x:Class="app_launcher.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:app_launcher"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Aplikacje użytkownika"
    Width="800"
    Height="600"
    mc:Ignorable="d">

    <Window.DataContext>
        <local:MainViewModel />
    </Window.DataContext>

    <Grid Margin="0" Background="WhiteSmoke">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ScrollViewer
            Grid.Row="1"
            Padding="10"
            VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Applications}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel
                            VerticalAlignment="Center"
                            ItemHeight="270"
                            ItemWidth="280"
                            Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type local:AppInfo}">
                        <Border
                            MinWidth="200"
                            Margin="5"
                            Padding="10"
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            CornerRadius="3">
                            <Border.Effect>
                                <DropShadowEffect
                                    BlurRadius="5"
                                    Opacity="0.4"
                                    ShadowDepth="3"
                                    Color="Black" />
                            </Border.Effect>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="White" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsConfigured}" Value="False">
                                            <Setter Property="Background" Value="LightGray" />
                                            <Setter Property="Opacity" Value="0.9" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel>
                                <TextBox
                                    Margin="0,0,0,5"
                                    BorderThickness="0"
                                    FontSize="22"
                                    FontWeight="Bold"
                                    Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                    ToolTip="Nazwa aplikacji" />
                                <TextBlock
                                    Margin="0,0,0,3"
                                    FontSize="16"
                                    Text="{Binding Path, TargetNullValue='N/A', FallbackValue='N/A'}"
                                    TextTrimming="CharacterEllipsis"
                                    ToolTip="{Binding Path}" />
                                <TextBox
                                    Margin="0,0,0,15"
                                    BorderThickness="0"
                                    FontSize="16"
                                    Text="{Binding Version, TargetNullValue='N/A', FallbackValue='N/A', UpdateSourceTrigger=PropertyChanged}"
                                    ToolTip="{Binding Version}" />
                                <Separator Margin="0,15,0,5" />

                                <Button
                                    Margin="0,2"
                                    Background="LightGreen"
                                    Command="{Binding DataContext.LaunchExecCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                    CommandParameter="{Binding}"
                                    Content="Uruchom"
                                    FontSize="16" />
                                <Button
                                    Margin="0,2"
                                    Command="{Binding DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                    CommandParameter="{Binding}"
                                    Content="Otwórz folder"
                                    FontSize="16" />
                                <Button
                                    Margin="0,2"
                                    Command="{Binding DataContext.SelectExecCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                    CommandParameter="{Binding}"
                                    Content="Wybierz plik"
                                    FontSize="16" />
                                <Button
                                    Margin="0,6,0,0"
                                    VerticalAlignment="Bottom"
                                    Background="LightCoral"
                                    Command="{Binding DataContext.RemoveAppCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                    CommandParameter="{Binding}"
                                    Content="Usuń wpis"
                                    FontSize="16">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Foreground" Value="White" />
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Foreground" Value="Black" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        <Button
            Grid.Row="0"
            Width="50"
            Height="50"
            Margin="0,0,40,20"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            VerticalContentAlignment="Top"
            Background="RoyalBlue"
            Command="{Binding AddAppCommand}"
            Content="+"
            FontSize="31"
            FontWeight="Bold"
            Foreground="White">
            <Button.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="25" />
                </Style>
            </Button.Resources>
            <Button.Effect>
                <DropShadowEffect
                    BlurRadius="5"
                    Opacity="0.4"
                    ShadowDepth="3"
                    Color="Black" />
            </Button.Effect>
        </Button>
    </Grid>
</Window>